<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Advanced features - Beam Documentation</title>

  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">
  <link href="../../../theme/css/beam.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/beam.css"/>

  
  <script>
    // Current page data
    var mkdocs_page_name = "Advanced features";
    var mkdocs_page_input_path = "user-guide/queries/advanced-features.md";
    var mkdocs_page_url = "/user-guide/queries/advanced-features/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Beam Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../about/faq/">Frequently Asked Questions</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../../models/">Models</a>
                </li>
                <li class="">
                    
    <a class="" href="../../databases/">Databases</a>
                </li>
                <li class="">
                    
    <a class="" href="../basic/">Basic Queries</a>
                </li>
                <li class="">
                    
    <a class="" href="../select/">More complex SELECTs</a>
                </li>
                <li class="">
                    
    <a class="" href="../ordering/">Ordering</a>
                </li>
                <li class="">
                    
    <a class="" href="../relationships/">Relationships</a>
                </li>
                <li class="">
                    
    <a class="" href="../aggregates/">Aggregates</a>
                </li>
                <li class="">
                    
    <a class="" href="../combining-queries/">Combining queries</a>
                </li>
                <li class="">
                    
    <a class="" href="../window-functions/">Window functions</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Advanced features</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#sql2003-t611-elementary-olap-operations">SQL2003 T611: Elementary OLAP operations</a></li>
    

    <li class="toctree-l3"><a href="#sql2003-t612-advanced-olap-operations">SQL2003 T612: Advanced OLAP operations</a></li>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Schema management</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../schema-guide/migrations/">The Migrations Framework</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../schema-guide/tool/">The beam-migrate tool</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../schema-guide/supported/">Supported migrations</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Backends</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../backends/beam-postgres/">beam-postgres</a>
                </li>
                <li class="">
                    
    <a class="" href="../../backends/beam-sqlite/">beam-sqlite</a>
                </li>
                <li class="">
                    
    <a class="" href="../../custom-backends/">Writing a Custom Backend</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../reference/models/">Models</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../reference/expression/">Expressions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../reference/queries/">Queries</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../reference/extensibility/">Extending</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">About</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../about/compatibility/">Compatibility Matrix</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../about/license/">License</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../about/release-notes/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Beam Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Advanced features</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>This page documents other advanced features that beam supports across backends
that support them.</p>
<h2 id="sql2003-t611-elementary-olap-operations">SQL2003 T611: Elementary OLAP operations</h2>
<p>This optional SQL2003 feature allows attaching arbitrary <code>FILTER (WHERE ..)</code>
clauses to aggregates. During querying only rows matching the given expression
are included in computing the aggregate. This can often be simulated in other
databases by an appropriate <code>CASE</code> expression, but beam will not do this
translation.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-haskell" aria-controls="tab-0-haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-postgres" aria-controls="tab-0-postgres" role="tab" data-toggle="tab" data-lang="postgres">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-haskell">
            <pre><code  class="haskell">aggregate_ (\i -&gt; (group_ (invoiceCustomer i), as_ @Int $ countAll_ `filterWhere_` (invoiceTotal i &gt;. 500), as_ @Int $ countAll_ `filterWhere_` (invoiceTotal i &lt;. 100))) $
all_ (invoice chinookDb)
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-postgres">
            <pre><code  class="postgres">SELECT &quot;t0&quot;.&quot;CustomerId&quot; AS &quot;res0&quot;,
       COUNT(*) FILTER (
                        WHERE (&quot;t0&quot;.&quot;Total&quot;) &gt; ('500.0')) AS &quot;res1&quot;,
       COUNT(*) FILTER (
                        WHERE (&quot;t0&quot;.&quot;Total&quot;) &lt; ('100.0')) AS &quot;res2&quot;
FROM &quot;Invoice&quot; AS &quot;t0&quot;
GROUP BY &quot;t0&quot;.&quot;CustomerId&quot;
</code></pre>
        </div>
    
        </div>
    
                </div>
                    </p>
<p>These combine as you'd expect with window functions. For example, to return each
invoice along with the average total of all invoices by the same customer where
the invoice was billed to an address in Los Angeles,</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-haskell" aria-controls="tab-1-haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-postgres" aria-controls="tab-1-postgres" role="tab" data-toggle="tab" data-lang="postgres">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-haskell">
            <pre><code  class="haskell">withWindow_ (\i -&gt; frame_ (partitionBy_ (invoiceCustomer i)) noOrder_ noBounds_)
            (\i w -&gt; (i, avg_ (invoiceTotal i) `filterWhere_` (addressCity (invoiceBillingAddress i) ==. just_ &quot;Los Angeles&quot;) `over_` w))
            (all_ (invoice chinookDb))
</code></pre>
        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-postgres">
            <pre><code  class="postgres">SELECT &quot;t0&quot;.&quot;InvoiceId&quot; AS &quot;res0&quot;,
       &quot;t0&quot;.&quot;CustomerId&quot; AS &quot;res1&quot;,
       &quot;t0&quot;.&quot;InvoiceDate&quot; AS &quot;res2&quot;,
       &quot;t0&quot;.&quot;BillingAddress&quot; AS &quot;res3&quot;,
       &quot;t0&quot;.&quot;BillingCity&quot; AS &quot;res4&quot;,
       &quot;t0&quot;.&quot;BillingState&quot; AS &quot;res5&quot;,
       &quot;t0&quot;.&quot;BillingCountry&quot; AS &quot;res6&quot;,
       &quot;t0&quot;.&quot;BillingPostalCode&quot; AS &quot;res7&quot;,
       &quot;t0&quot;.&quot;Total&quot; AS &quot;res8&quot;,
       AVG(&quot;t0&quot;.&quot;Total&quot;) FILTER (
                                 WHERE (&quot;t0&quot;.&quot;BillingCity&quot;) = ('Los Angeles')) OVER (PARTITION BY &quot;t0&quot;.&quot;CustomerId&quot;) AS &quot;res9&quot;
FROM &quot;Invoice&quot; AS &quot;t0&quot;
</code></pre>
        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p><code>FILTER (WHERE ..)</code> must be applied directly to a SQL aggregate function,
but this isn't enforced at compile time. This may be fixed in a later
version of beam.</p>
</div>
<p>This extension also provides various window functions for SQL. The only one beam
currently implements is <code>RANK()</code> via the <code>rank_</code> function. Contributions are
appreciated!</p>
<h2 id="sql2003-t612-advanced-olap-operations">SQL2003 T612: Advanced OLAP operations</h2>
<p>This provides both the <code>PERCENT_RANK()</code> and <code>CUME_DIST()</code> functions as
<code>percentRank_</code> and <code>cumeDist_</code> respectively.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../schema-guide/migrations/" class="btn btn-neutral float-right" title="The Migrations Framework">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../window-functions/" class="btn btn-neutral" title="Window functions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../window-functions/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../../schema-guide/migrations/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

    <script src="../../../js/theme.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
</script>


</body>
</html>
